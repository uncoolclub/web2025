<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>📄 문서 보기</title>
    <link rel="stylesheet" href="index.css" />
    <link rel="stylesheet" href="markdown-styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  </head>
  <body>
    <div id="content">불러오는 중...</div>

    <script>
      const params = new URLSearchParams(window.location.search);
      const file = params.get("file");
      const contentDiv = document.getElementById("content");

      if (file) {
        fetch(file)
          .then((res) => {
            if (!res.ok) {
              throw new Error(`HTTP error! status: ${res.status}`);
            }
            return res.text();
          })
          .then((md) => {
            // 1. Parse Markdown to HTML
            contentDiv.innerHTML = marked.parse(md);

            // 2. Apply Syntax Highlighting AFTER content is in the DOM
            // Ensure hljs is loaded before calling this
            if (typeof hljs !== "undefined") {
              // Tell highlight.js to find and highlight all code blocks
              hljs.highlightAll();
              // Or, more specifically:
              // contentDiv.querySelectorAll('pre code').forEach((block) => {
              //   hljs.highlightElement(block);
              // });
            } else {
              console.warn("highlight.js not loaded.");
            }
          })
          .catch((err) => {
            contentDiv.innerHTML = `<p style="color: red;">문서를 불러올 수 없습니다: ${err.message}</p>`;
            console.error(err);
          });
      } else {
        contentDiv.textContent = "파일이 지정되지 않았습니다.";
      }
    </script>
  </body>
</html>
